<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:400,700"
    />
    <!-- https://fonts.google.com/specimen/Roboto -->
    <link rel="stylesheet" href="css/fontawesome.min.css" />
    <!-- https://fontawesome.com/ -->
    <!-- http://api.jqueryui.com/datepicker/ -->
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.5/firebase-firestore.js"></script>
    <!-- https://getbootstrap.com/ -->
    <link rel="stylesheet" href="css/style.css">
    <link href='https://fonts.googleapis.com/css?family=Shadows Into Light Two' rel='stylesheet'>

  </head>
  <center><div style="width:75%;height:75%;background-color: #52b36c;display: none;" id="product_submitted">
    <h1 style="color: white;">Product Submitted!</h1>
    <p>Time To Make Some Money!</p><hr>

    <input type="button" class="btn btn-primary btn-block mx-auto" value="CREATE ANOTHER PRODUCT" style="margin-bottom: 30px;" onclick="location.reload()"/>
  </div></center>
      <div class="row" style="margin-top:50px;" id="product_form">
        <div class="col-xl-9 col-lg-10 col-md-12 col-sm-12 mx-auto">
          <div class="tm-bg-primary-dark tm-block tm-block-h-auto">
            <div class="row">
              <div class="col-12">
                <center><h2 class="tm-block-title d-inline-block" style="font-size: 40px;font-family: 'Shadows Into Light Two';">New Product</h2></center>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <h2 class="tm-block-title d-inline-block">General Info</h2>
              </div>
            </div><hr>
            <div class="row tm-edit-product-row">
              <div class="col-xl-6 col-lg-6 col-md-12">
                <form action="" class="tm-edit-product-form">
                  <div class="form-group mb-3">
                    <label for="name">Product Name
                    </label>
                    <input id="name" name="name" placeholder="Product Name" type="text"class="form-control validate" required/>
                  </div>
                  <div class="form-group mb-3">
                    <label for="name">Product Price (USD)
                    </label>
                    <input id="price" name="price" placeholder="Product Price" type="text"class="form-control validate" required/>
                  </div>
                  <div class="form-group mb-3">
                    <label for="category">Product Category</label>
                    <select class="custom-select tm-select-accounts" id="category">
                      <option selected>Select category</option>
                      <option value="1">New Arrival</option>
                      <option value="2">Most Popular</option>
                      <option value="3">Trending</option>
                    </select>
                  </div>
                  <div class="form-group mb-3" hidden="hidden">
                    <label for="subcategory">Product Sub-Category</label>
                    <select class="custom-select tm-select-accounts" id="subcategory">
                      <option selected>Select category</option>
                      <option value="1">New Arrival</option>
                      <option value="2">Most Popular</option>
                      <option value="3">Trending</option>
                    </select>
                  </div>
    
              </div>
              <div class="col-xl-6 col-lg-6 col-md-12 mx-auto mb-4" style="color: white;" id="cover-drop">
                <label for="cover-drop">Upload Cover Image
              </label>
                <div class="tm-product-img-dummy mx-auto" id="imgr_pic">
                  <i class="fas fa-cloud-upload-alt tm-upload-icon" id="prickpic" onclick="document.getElementById('fileInput').click();"></i>
                </div>
                <div class="custom-file mt-3 mb-3">
                  <div class="dropzone">
                  <input type="button" class="btn btn-primary btn-block mx-auto" value="UPLOAD PRODUCT COVER IMAGE" onclick="document.getElementById('fileInput').click();"/>
                </div>
                </div>
              </div>
              <div class="form-group col-12">
                    <label for="description">Product Short Description</label>
                    <p style="color:white">Shown On Product Card Dsiplay</p>
                    <textarea class="form-control validate" rows="3" required placeholder="Product Description" id="prod_desc" style="color: black"></textarea>
              </div>
              <div class="form-group col-12">
                    <label for="description">Product Description</label>
                    <p style="color:white">Shown On Product Page. Markdown Markup Accepted</p>
                    <iframe src="./arcflash.html" width="100%" height="100%" id="markflash" scrolling="no" style="border:none;min-height:470px;overflow-y: hidden;"></iframe>
              </div>

              <div class="row tm-edit-product-row" style="width: 100%">
                <div class="col-12"><br><br>
                  <h2 class="tm-block-title d-inline-block">Shipping Settings</h2>
                  <p style="color: white;">*Shipping Refers To The Product Being Delivered To The Customer's Email/Account*</p><hr><br>
                      
                  <div class="row tm-edit-product-row">
                  <div class="col-xl-6 col-lg-6 col-md-12">
                    <form action="" class="tm-edit-product-form">
                      <div class="form-group mb-3">
                        <center><label for="producturl" style="font-size: 20px;">Provide Product Files Download Link
                        </label></center><hr>
                        <input id="DownloadLink" name="DownloadLink" placeholder="Download Link" type="text"class="form-control validate" required/>
                      </div>
                      <center><p style="color: white;">OR</p></center>
                     
                      <div class="custom-file mt-3 mb-3">
                        <input type="file" id="files" name="files[]" style="display:none;" multiple/>
                        <input type="button" class="btn btn-primary btn-block mx-auto" value="UPLOAD YOUR DIGITAL PRODUCT" onclick="document.getElementById('files').click();"/>
                        <center><p style="color:white">* Please Upload The Files Which Will Be Sent To The Customer!</p></center>
                      </div>
                      
                  </div>
                    <div class="col-xl-6 col-lg-6 col-md-12 mx-auto mb-4" style="color: white;" id="shipping-selection">
                      <center><form id="mainForm" name="mainForm">
                        <label for="producturl" style="font-size: 20px;">Shipping Options
                        </label><br><hr>
                        <input type="radio" name="rads" value="Complex" onclick="Radclick(this.value)" /><span style="color:white;">I Will Ship To My Customers</span><br>
                        <input type="radio" name="rads" onclick="Radclick(this.value)" value="standard" /><span style="color:white">I Want Splurket To Ship My Products</span>
                    </form>
                    <div style="color: white;display: none;" id="shipping-template">
                      <div class="custom-file mt-3 mb-3">
                        <input id="templateupload" type="file" style="display:none;" />
                        <input type="button" accept=".html" class="btn btn-primary btn-block mx-auto" value="UPLOAD YOUR SHIPPING TEMPLATE" onclick="document.getElementById('templateupload').click();"/>
                      </div>
                      <center><p style="color: white;padding-top: 10px;">OR</p></center>
                      <a href="creators.splurket.com/Splurkator"><button type="submit" class="btn btn-primary btn-block text-uppercase">Create Your Own Email Template</button></a>
                      <center><p style="color: white;padding-top: 10px;">OR</p></center>
                      <a href="creators.splurket.com/shipping-templates"><button class="btn btn-primary btn-block text-uppercase">Use A Splurket-Made Template</button></a>
                    </div>
                  </center>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div><br>
              


              <!--<div class="row">
                <div class="col-12">
                  <h2 class="tm-block-title d-inline-block">Product Settings</h2>
                </div>
              </div><hr>-->

              <div class="row">
                <div class="col-12">
                <button type="submit" class="btn btn-primary btn-block text-uppercase" onclick="Addproduct()">Create New Product</button>
              </div>
            </div>
            </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="js/jquery-3.3.1.min.js"></script>
    <!--<script src="js/main.js"></script>-->
    <script type="text/javascript" src="./js/imgur.js"></script>
    <script type="text/javascript" src="./js/upload.js"></script>
    <!-- https://jquery.com/download/ -->
    <script src="jquery-ui-datepicker/jquery-ui.min.js"></script>
    <!-- https://jqueryui.com/download/ -->
    <script src="js/bootstrap.min.js"></script>
    <!-- https://getbootstrap.com/ -->
    <script>
      function Radclick(radVal) {
        if (radVal == "Complex" ){
          document.getElementById('shipping-template').style.display = "block";

        }
        if (radVal == "standard") {
          document.getElementById('shipping-template').style.display = "none";
        }
    }

    </script>
    <script>
      //HANDLE TEMPALTE INPUT HERE TO EXTRACT HTML FROM FILE AND SAVE TO FIREBASE.
var data1;
var user_name
var firebaseConfig = {
    apiKey: "AIzaSyC-BUGGSsvUX8z4W1LcsJzS59yrL4__EsE",
    authDomain: "splurket-66df1.firebaseapp.com",
    databaseURL: "https://splurket-66df1-default-rtdb.firebaseio.com",
    projectId: "splurket-66df1",
    storageBucket: "splurket-66df1.appspot.com",
    messagingSenderId: "286706779903",
    appId: "1:286706779903:web:fd91c29319f9804e192eca",
    measurementId: "G-QWQ2M658KL"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  db.settings({ timestampsInSnapshots: true });
  firebase.analytics();


//Handle Image Upload
function imagelink(get_link1){
  get_link = get_link1;
}



var pro_pic;
function Addproduct() {
  var markflash = document.getElementById('markflash')
  var product_name = document.getElementById('name').value;
       if(typeof product_name == 'undefined'){
           var product_name = "";
}

  var product_price = document.getElementById('price').value;
       if(typeof product_price == 'undefined'){
           var product_price = "";
}

  var product_category = document.getElementById('category').value;
       if(typeof product_category == 'undefined'){
           var product_category = "";
}

  var product_subcategory = document.getElementById('subcategory').value;
       if(typeof product_subcategory == 'undefined'){
           var product_subcategory = "";
}


  var product_cover = get_link;

  var product_downloadlink = document.getElementById('DownloadLink').value;
       if(typeof product_downloadlink == 'undefined'){
           var product_downloadlink = "";
}


  var product_ship_selection = document.getElementById('shipping-selection').value;
       if(typeof product_ship_selection == 'undefined'){
           var product_ship_selection = "";
}

  var product_ship_template = document.getElementById('shipping-template').value;
       if(typeof product_ship_template == 'undefined'){
           var product_ship_template = "";
}
  var product_description = document.getElementById('prod_desc').value;
       if(typeof product_description == 'undefined'){
           var product_description = "";
}
  var text = document.getElementById('markflash').contentWindow.document.getElementById('textarea1').value
       if(typeof product_description == 'undefined'){
           var product_description = "";
}else if(typeof product_description != 'undefined'){
         }
console.log(JSON.stringify(text))

  var user;
  var email1;
  firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        // User is signed in.
        user = firebase.auth().currentUser;
        //splurket@gmail.com
        email1 = user.email;
        var myHeaders = new Headers();
  myHeaders.append("Content-Type", "text/plain");

      var raw = JSON.stringify({
        "flemishGiant": `${email1}`
      });
      //document.write(raw)
      var requestOptions = {
        method: 'POST',
        headers: myHeaders,
        body: raw,
        redirect: 'follow'
      };

      fetch("https://script.google.com/macros/s/AKfycbwd3VKlX6ajjUYSkrg9YOEu3fDg-F0PJsRvv8ia0bhPX6OHn_Lk1a4N7dVx3nKEacui/exec", requestOptions)
        .then(function (response) {
            return response.json();
        })
        .then(function (data) {
          //should be a base64 string by now
          getuserdata(data);
      });
    }
    var product_id;

    var strings5= btoa(`${product_name}&${user.email}`)
    //var strings4 = data.encryptedstring.split('&')
    console.log(strings5)
    product_id = strings5
    pro_pic = window.top.document.getElementById('avatarpic').src
            //document.write(JSON.stringify(data.encryptedstring))

            db.collection('products').doc(product_id).set({
                    dispdesc: text,
                    product_name: product_name,
                    product_creator: user_name,
                    product_creatorpic: pro_pic,
                    product_price: product_price,
                    product_category: product_category,
                    product_subcategory: product_subcategory,
                    product_cover: product_cover,
                    product_downloadlink: product_downloadlink,
                    product_ship_selection: product_ship_selection,
                    product_ship_template: product_ship_template,
                    product_description: product_description,
                    reviewsn: '0',
                    product_id: product_id,
            });
            var myHeaders = new Headers();
          myHeaders.append("Content-Type", "text/plain");

          var raw = JSON.stringify({
            "flemishGiant": `${user.email}`
          });
          console.log(raw)
          //document.write(raw)
          var requestOptions = {
            method: 'POST',
            headers: myHeaders,
            body: raw,
            redirect: 'follow'
          };

          fetch("https://script.google.com/macros/s/AKfycbwd3VKlX6ajjUYSkrg9YOEu3fDg-F0PJsRvv8ia0bhPX6OHn_Lk1a4N7dVx3nKEacui/exec", requestOptions)
            .then(function (response) {
                return response.json();
            })
            .then(function (data) {
              var profile_id= data.encryptedstring;
              let [month, date, year]    = new Date().toLocaleDateString("en-US").split("/")
          //document.write(JSON.stringify(data.encryptedstring))
            db.collection('users').doc(profile_id).collection('myproducts').doc(product_id).set({
                    product_name: product_name,
                    product_creator: email1,
                    product_price: product_price,
                    product_category: product_category,
                    product_subcategory: product_subcategory,
                    views:'0',
                    purchases:'0',
                    reviews:'0',
                    creation_date: `${month}, ${date}, ${year}`,
                    status: 'Active',

            });
            document.getElementById('product_form').style.display = "none";
            document.getElementById('product_submitted').style.display = "block";
            });
          });

}
  function getuserdata(data) {
      email = data.encryptedstring;
          var docRef = db.collection("users").doc(email);
          docRef.get().then((doc) => {
              if (doc.exists) {
                  data1 = doc.data()
                  pro_pic = data1.pro_pic;
                  if (data1.username == "" ){
                      user_name = data1.email
                  }
                  if (data1.username != "") {
                      user_name = data1.username;
                  }
              } else {
                  // doc.data() will be undefined in this case
                  console.log("No such document!");
              }
          }).catch((error) => {
              console.log("Error getting document:", error);
          });
  }

    </script>
  </body>
</html>
